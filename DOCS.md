# Консольная система для проведения спортивных соревновнований

## Обзор приложения

Данный проект реализует консольное приложение для помощи при проведении
спортивных соревнований по циклическим видам спорта.

Название, дата, время начала старта и вид спорта; список
групп и список возможных квалификаций спортсмена,
а также списки дистанций, соответствующих группам, 
и критериев прохождения дистанции в виде
списка контрольных пунктов с отметкой по времени должны быть записаны 
в конфигурационном файле в формате yaml, по примеру, указанному ниже

```yaml
eventName:
  Первенство Пятой Бани

eventDate:
  20.02.2022

eventTime:
  12:00:00

eventSport:
  orienteering


ranks:
  - 3ю
  - 2ю
  - 1ю
...


groups:
  - group: М10
    distance: МЖ9 10
  - group: М12
    distance: М12

...


criteria:
  - distance: М18 21 40 50
    checkpoints:
    - 31
    - 32
    - 33
    ...
  - distance: МЖ9 10
    checkpoints:
    - 32
    - 46
    - 34
    - 33
    - 53
  
  ...

```


Предполагается трёхэтапное использование программы.
На первом этапе по заявочным спискам формируются стартовые
протоколы и проводится жеребьевка. На втором этапе по данным, 
полученным с систем электронной отметки на контрольных пунктах,
генерируются результаты и сплиты участников в каждой группе.
Наконец, по результатам групп подсчитываются очки каждого спортсмена,
и генерируется протокол результатов по командам.

Этапы не зависят друг от друга, также допускается частичное использование 
программы (например, только жеребьевка и составление стартового протокола,
либо только генерация результатов команд по уже известным результатам по
каждой группе спортсменов)

## Этап первый: генерация стартовых списков

На вход программе подается путь к конфигурационному файлу, ключевое слово
`protocolStart` и список путей к файлам заявочных списков

```
$ competition pathConfig protocolStart pathRequestList1, pathRequestList2 
```

Заявочные списки подаются в формате csv, в соответствии с примером, указанным
ниже. В заявочном списке в первой строке указывается
название команды, далее идет список спортсменов с указанием
желаемой группы участника, фамилии, имени, года рождения
и разряда. Спортсмен может выступать без разряда, однако группа 
участника и разряд, если указан, должны быть упомянуты в конфигурационном
файле. При некорректности данных спортсмен не будет допущен к участию,
и не будет участвовать в жеребьевке.

```csv
СПбГУ,,,,
Ж12,Рощина,Надежда,2003,1р
М10,Санников,Вадим,2003,3р
М10,Ананикян,Александр,2002,2р
```

Жеребьевка внутри группы проводится случайным образом.
Не допущенные к участию по причинам некорректных данных участники
в стартовый протокол не вносятся. Все ошибки, обнаруженные в заявочных
списках, логируются.

Пример стартового протокола, сформированного на заявочном списке
в примере выше

```csv
Ж12,,,,,,
11,Рощина,Надежда,2003,1р,СПбГУ,12:00:00
М10,,,,,,
21,Санников,Вадим,2003,3р,СПбГУ,12:01:00
22,Ананикян,Александр,2002,2р,СПбГУ,12:02:00
```


## Этап второй: составление протоколов результатов

В текуще версии приложение поддерживается составление протоколов результатов
по данным, полученным с помощью систем электронной отметки. Для получения результатов нужно
указать путь к конфигурационному файлу, ключевое слово `resultsGroup` и далее указать
путь к файлу, содержащему данные о чекпоинтах.


Для ввода пока что нельзя использовать альтернативный способ 
представления данных о чекпоинтах с помощью параметра
`--checkpointAthlete` или `-cpa`, поэтому по умолчанию его значение -
false

```
$ competition pathConfig resultsGroup path1
```

```
$ competition pathConfig resultsGroup <InputStream>
```


Данные о чекпоинтах принимаются в формате csv. В файле идет название конкретного чекпоинта,
а далее засеченные результаты: номер атлета по стартовому протоколу и время засечки.

Пример данных для примеров выше:


```csv
32,
11,12:02:58
21,12:02:58
22,12:04:53
46,
11,12:04:16
22,12:05:13
21,12:06:28
33,
22,12:07:41
11,12:07:56
21,12:09:00
47,
11,12:09:11
48,
11,12:12:32
52,
11,12:14:08
51,
11,12:18:41
50,
11,12:20:11
49,
11,12:22:00
53,
22,12:10:11
21,12:11:01
11,12:23:31
34,
22,12:06:41
21,12:07:39
```

Программа сгенерирует протоколы результатов для каждой группы:

```csv
Ж12,,,,,,,,,
1,11,Рощина,Надежда,2003,1р,СПбГУ,00:23:31,1,+00:00:00
М10,,,,,,,,,
1,22,Санников,Вадим,2003,3р,СПбГУ,00:08:11,1,+00:00:00
2,21,Ананикян,Александр,2002,2р,СПбГУ,00:10:01,2,+00:01:50
```

А также сплиты по данной группе:
```csv
Ж12,,,,,,,,,
1,11,Рощина,Надежда,2003,1р,СПбГУ,1,+00:00:00,32,00:02:58,46,00:01:18,33,00:03:40,47,00:01:15,48,00:03:21,52,00:01:36,51,00:04:33,50,00:01:30,49,00:01:49,53,00:01:31
М10,,,,,,,,,
1,22,Санников,Вадим,2003,3р,СПбГУ,1,+00:00:00,32,00:02:53,46,00:00:20,34,00:01:28,33,00:01,53,00:02:30
2,21,Ананикян,Александр,2002,2р,СПбГУ,2,+00:01:50,32,00:01:58,46,00:03:30,34,00:01:11,33,00:01:21,53,00:02:01
```

Участники, не завершившие дистанцию, а также участники, не взявшиие все чекпоинты 
или нарушившие порядок прохождения дистанции, будут сняты с соревнований. Их результат
не будет посчитан, и в обоих протоколах отразится вердикт `снят`

```csv
3,23,Шишкин,Владислав,2002,1ю,МГУ,снят,3,
```

## Этап третий: генерация результатов команд

После составления протоколов результатов по каждой группе
можно подсчитать очки каждого участника и, соответственно, каждой команды.
Для этого нужно указать путь к конфигурационному файлу, и ключевое слово
`resultsTeam`. По умолчанию будут использованы сгенерированные 
на предыдущем этапе результаты соревнований, однако посчитать очки можно
для любых протоколов результатов, соответствующих формату. Для этого нужно
указать путь к файлу после команды `resultsTeam`

```
$ competition pathConfig resultsTeam
```

```
$ competition pathConfig resultsTeam path
```

Пример сгенерированных программой данных:

```csv
СПбГУ,277,,,,,,
11,Рощина,Надежда,2003,1р,Ж12,1,100
22,Санников,Вадим,2003,3р,М10,1,100
21,Ананикян,Александр,2002,2р,М10,2,77
```


# Краткий список команд и параметров


| FullName                 | ShortName          | Описание                                                             |
| ----------               | ---------          | --------------------------                                           |
| --help                   | -h                 | Аптечка                                                              |
| title                    | title              | Название соревнования                                                |
| date                     | date               | Дата соревнования                                                    |
| protocolStart            | protocolStart      | Команда: Получить протоколы старта                                   |
| resultsAthlete           | resultsGroup       | Команда: Получить результаты для групп                               |
| --protocolStart          | -ps                | Параметр к resultsGroup: путь к протоколу старта                     |
| --checkpointAthlete      | -cpa               | Параметр к resultsGroup: информация чекпоинтов в виде "по участнику" (`default = false`) |
| resultsTeam              | resultsTeam        | Команда: Получить результаты команд                                  |



## Тестирование

Для проверки работы программы используется набор тестов.


Скрипт `testsParser.kt` проверяет корректность парсинга
аргументов командной строки


Скрипт `testsCommands.kt` проверяет корректность работы
каждой из трех команд

